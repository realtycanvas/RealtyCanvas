generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Property {
  id                  String          @id @default(uuid())
  title               String
  description         String
  price               Int
  address             String
  location            String
  currency            String          @default("INR")
  featuredImage       String
  galleryImages       String[]
  beds                Int             @default(0)
  baths               Int             @default(0)
  area                Int             @default(0)
  createdAt           DateTime        @default(now())
  aboutDescription    String?
  aboutTitle          String?
  bannerDescription   String?
  bannerSubtitle      String?
  bannerTitle         String?
  builderDescription  String?
  builderLogo         String?
  builderName         String?
  facilities          Json?
  faqs                Json?
  floorPlans          Json?
  highlights          Json?
  relatedProperties   String[]        @default([])
  sitePlanDescription String?
  sitePlanImage       String?
  sitePlanTitle       String?
  isTrending          Boolean         @default(false)
  totalClicks         Int             @default(0)
  propertyClicks      PropertyClick[]
}

model Project {
  id                  String                  @id @default(uuid())
  slug                String                  @unique
  title               String
  subtitle            String?
  description         String
  category            ProjectCategory         @default(COMMERCIAL)
  status              ProjectStatus           @default(PLANNED)
  reraId              String?
  developerName       String?
  developerLogo       String?
  possessionDate      DateTime?
  launchDate          DateTime?
  address             String
  locality            String?
  city                String?
  state               String?
  latitude            Float?
  longitude           Float?
  currency            String                  @default("INR")
  featuredImage       String
  galleryImages       String[]
  videoUrl            String?
  videoUrls           String[]                @default([])
  createdAt           DateTime                @default(now())
  updatedAt           DateTime                @updatedAt
  basePrice           String?
  priceRange          String?
  priceMin            Int?
  priceMax            Int?
  bannerTitle         String?
  bannerSubtitle      String?
  bannerDescription   String?
  aboutTitle          String?
  aboutDescription    String?
  sitePlanImage       String?
  sitePlanTitle       String?
  sitePlanDescription String?
  minRatePsf          String?
  maxRatePsf          String?
  minUnitArea         Int?
  maxUnitArea         Int?
  totalUnits          Int?
  soldUnits           Int?
  availableUnits      Int?
  // Optional SEO overrides
  seoTitle            String?
  seoDescription      String?
  seoKeywords         String[]               @default([])
  isTrending          Boolean                 @default(false)
  totalClicks         Int                     @default(0)
  landArea            String?
  numberOfApartments  Int?
  numberOfTowers      Int?
  numberOfFloors      Int?
  features            String?
  amenities           Amenity[]
  anchors             AnchorTenant[]
  configurations      ConfigurationType[]
  construction        ConstructionMilestone[]
  documents           Document[]
  faqs                Faq[]
  floorPlans          FloorPlan[]
  highlights          Highlight[]
  media               Media[]
  nearbyPoints        NearbyPoint[]
  pricingPlans        PricingPlan[]
  pricingTable        PricingTable[]
  projectClicks       ProjectClick[]
  units               Unit[]

  // Indexes to accelerate common filters and sorts used by the API
  @@index([createdAt], map: "idx_project_created_at_prisma")
  @@index([updatedAt], map: "idx_project_updated_at_prisma")
  @@index([status], map: "idx_project_status_prisma")
  @@index([category], map: "idx_project_category_prisma")
  @@index([status, updatedAt], map: "idx_project_status_updated_prisma")
  @@index([priceMin], map: "idx_project_price_min_prisma")
  @@index([priceMax], map: "idx_project_price_max_prisma")
  @@index([priceMin, priceMax], map: "idx_project_price_range_prisma")
}

model Highlight {
  id        String  @id @default(uuid())
  projectId String
  label     String
  icon      String?
  sortOrder Int     @default(0)
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Amenity {
  id        String  @id @default(uuid())
  projectId String
  category  String
  name      String
  details   String?
  sortOrder Int     @default(0)
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Faq {
  id        String  @id @default(uuid())
  projectId String
  question  String
  answer    String
  sortOrder Int     @default(0)
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Media {
  id        String    @id @default(uuid())
  projectId String
  type      MediaType
  url       String
  caption   String?
  tags      String[]
  floor     String?
  sortOrder Int       @default(0)
  project   Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model FloorPlan {
  id        String  @id @default(uuid())
  projectId String
  level     String
  title     String?
  imageUrl  String
  details   Json?
  sortOrder Int     @default(0)
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Document {
  id         String    @id @default(uuid())
  projectId  String
  docType    DocType
  title      String
  fileUrl    String
  number     String?
  issueDate  DateTime?
  expiryDate DateTime?
  project    Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model ConfigurationType {
  id           String   @id @default(uuid())
  projectId    String
  type         UnitType
  level        String?
  areaRangeMin Int?
  areaRangeMax Int?
  notes        String?
  sortOrder    Int      @default(0)
  project      Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  units        Unit[]
}

model Unit {
  id               String             @id @default(uuid())
  projectId        String
  configurationId  String?
  unitNumber       String
  type             UnitType
  floor            String
  areaSqFt         String
  frontageFt       Float?
  ceilingHeightFt  Float?
  fitOutStatus     FitOutStatus?
  nearAnchor       Boolean            @default(false)
  isCorner         Boolean            @default(false)
  visibilityScore  Int?
  ventilationReady Boolean?
  priceTotal       Int?
  ratePsf          Float?
  leaseModel       LeaseModel?
  lockInMonths     Int?
  escalationPct    Float?
  availability     Availability       @default(AVAILABLE)
  notes            String?
  configuration    ConfigurationType? @relation(fields: [configurationId], references: [id])
  project          Project            @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model AnchorTenant {
  id        String       @id @default(uuid())
  projectId String
  name      String
  category  String
  status    AnchorStatus @default(PLANNED)
  floor     String?
  areaSqFt  String?
  project   Project      @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model NearbyPoint {
  id            String     @id @default(uuid())
  projectId     String
  type          NearbyType
  name          String
  distanceKm    Float?
  travelTimeMin Int?
  project       Project    @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model PricingPlan {
  id        String   @id @default(uuid())
  projectId String
  name      String
  planType  PlanType
  schedule  Json?
  taxes     Json?
  charges   Json?
  notes     String?
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model PricingTable {
  id             String  @id @default(uuid())
  projectId      String
  type           String
  reraArea       String
  price          String
  pricePerSqft   String?
  availableUnits Int?
  floorNumbers   String?
  features       Json?
  project        Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model ConstructionMilestone {
  id        String    @id @default(uuid())
  projectId String
  name      String
  status    String
  date      DateTime?
  images    String[]
  project   Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model PropertyClick {
  id          String   @id @default(uuid())
  propertyId  String
  clickCount  Int      @default(1)
  clickDate   DateTime
  lastClickAt DateTime @default(now())
  clientIP    String?
  createdAt   DateTime @default(now())
  property    Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@unique([propertyId, clickDate])
}

model ProjectClick {
  id          String   @id @default(uuid())
  projectId   String
  clickCount  Int      @default(1)
  clickDate   DateTime
  lastClickAt DateTime @default(now())
  clientIP    String?
  createdAt   DateTime @default(now())
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, clickDate])
}

model Lead {
  id           String     @id @default(uuid())
  name         String
  phone        String
  email        String
  propertyType String
  city         String
  state        String
  timeline     String?
  projectSlug  String?
  projectTitle String?
  sourcePath   String?
  createdAt    DateTime   @default(now())
  status       LeadStatus @default(NEW)
}

enum LeadStatus {
  NEW
  CONTACTED
  QUALIFIED
  CLOSED
  ARCHIVED
}

enum ProjectCategory {
  COMMERCIAL
  RETAIL_ONLY
  MIXED_USE
  RESIDENTIAL
}

enum ProjectStatus {
  PLANNED
  UNDER_CONSTRUCTION
  READY
}

enum UnitType {
  RETAIL
  ANCHOR
  FOOD_COURT
  MULTIPLEX
  OFFICE
  KIOSK
  APARTMENT
  STUDIO
  VILLA
  PLOT
}

enum FitOutStatus {
  BARE
  VANILLA
  FURNISHED
}

enum LeaseModel {
  STRATA
  DEVELOPER_LEASE
  LEASE_ASSURED
}

enum Availability {
  AVAILABLE
  HOLD
  SOLD
  LEASED
}

enum MediaType {
  IMAGE
  VIDEO
  PLAN
  BROCHURE
  VIRTUAL_TOUR
}

enum DocType {
  APPROVAL
  BROCHURE
  SPEC
  TITLE
}

enum AnchorStatus {
  PLANNED
  CONFIRMED
  OPERATING
}

enum NearbyType {
  METRO
  MALL
  OFFICE_HUB
  HOTEL
  ROAD
  AIRPORT
}

enum PlanType {
  CLP
  DOWN_PAYMENT
  SUBVENTION
  LEASE_BACK
}
